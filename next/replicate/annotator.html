<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-replicate/annotator">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Annotator | Data Pipeline for Spectrum</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ml4wireless.github.io/adsb-nats/next/replicate/annotator"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Annotator | Data Pipeline for Spectrum"><meta data-rh="true" name="description" content="The Annotator is a module within our data pipeline that is responsible for enriching the processed radio data with additional meaningful information. For our application, we downloaded data from the FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database and used it to add additional information to each packet."><meta data-rh="true" property="og:description" content="The Annotator is a module within our data pipeline that is responsible for enriching the processed radio data with additional meaningful information. For our application, we downloaded data from the FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database and used it to add additional information to each packet."><link data-rh="true" rel="icon" href="/adsb-nats/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ml4wireless.github.io/adsb-nats/next/replicate/annotator"><link data-rh="true" rel="alternate" href="https://ml4wireless.github.io/adsb-nats/next/replicate/annotator" hreflang="en"><link data-rh="true" rel="alternate" href="https://ml4wireless.github.io/adsb-nats/next/replicate/annotator" hreflang="x-default"><link rel="stylesheet" href="/adsb-nats/assets/css/styles.93701f4a.css">
<link rel="preload" href="/adsb-nats/assets/js/runtime~main.23d5e543.js" as="script">
<link rel="preload" href="/adsb-nats/assets/js/main.d57262cb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/adsb-nats/"><div class="navbar__logo"><img src="/adsb-nats/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/adsb-nats/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SpecPipe</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/adsb-nats/next">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/adsb-nats/next">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/adsb-nats/next/replicate/annotator">Next</a></li><li><a class="dropdown__link" href="/adsb-nats/replicate/annotator">1.0.1</a></li><li><a class="dropdown__link" href="/adsb-nats/1.0.0/replicate/annotator">1.0.0</a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/next">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/next/about">About the Project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/next/local">Setup &amp; Run Through (Local)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/adsb-nats/next/category/replicate-our-pipeline">Replicate our Pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replicate our Pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/aws">NATS AWS Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/client">Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adsb-nats/next/replicate/annotator">Annotator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/elastic">Storage &amp; Search Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/backend">Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/frontend">Frontend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/dashboard">Dashboards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/next/replicate/stress_test">Stress Test</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/next/doc_tutorial">Documentation Website</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Data Pipeline for Spectrum<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/adsb-nats/replicate/annotator">latest version</a></b> (<!-- -->1.0.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/adsb-nats/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/adsb-nats/next/category/replicate-our-pipeline"><span itemprop="name">Replicate our Pipeline</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Annotator</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Annotator</h1><blockquote><p>The Annotator is a module within our data pipeline that is responsible for enriching the processed radio data with additional meaningful information. For our application, we downloaded data from the <a href="https://www.faa.gov/licenses_certificates/aircraft_certification/aircraft_registry/releasable_aircraft_download" target="_blank" rel="noopener noreferrer">FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database</a> and used it to add additional information to each packet. </p></blockquote><blockquote><p>This documentation will take you through the process of containerizing the annotator and running it locally, and then migrating it to AWS. If you aren‚Äôt sure what that means no worries there will explanations at each step. </p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-local-containerizing--running-the-annotator">1. Local: Containerizing &amp; Running the Annotator<a href="#1-local-containerizing--running-the-annotator" class="hash-link" aria-label="Direct link to 1. Local: Containerizing &amp; Running the Annotator" title="Direct link to 1. Local: Containerizing &amp; Running the Annotator">‚Äã</a></h2><p><strong>Key Terms:</strong></p><blockquote><p><strong>Containerizing</strong> applications provides portability, allowing them to run consistently across different environments, and enables efficient resource utilization and scalability, making it easier to deploy, manage, and scale applications effectively. Containerizing applications using Docker provides additional advantages such as simplified packaging, distribution, and deployment. <strong>Docker</strong> allows for easy creation and management of containers, making it a popular choice for containerization due to its comprehensive tooling and ecosystem support.</p></blockquote><p>üí° In this section will be containerizing and running the annotator program locally (on a personal computer and not in      AWS). This will essentially take the data packets from the client program and supplement them with additional information from another data source (For our airplane tracker application, we downloaded data from the <a href="https://www.faa.gov/licenses_certificates/aircraft_certification/aircraft_registry/releasable_aircraft_download" target="_blank" rel="noopener noreferrer">FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database</a> and used it to append additional information to each packet).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-prep-for-containerization">1. Prep for Containerization<a href="#1-prep-for-containerization" class="hash-link" aria-label="Direct link to 1. Prep for Containerization" title="Direct link to 1. Prep for Containerization">‚Äã</a></h3><ul><li>Navigate to the annotator‚Äôs directory (<code>aircraft-annotator</code>) within the cloned repo. This entire section of setup will be performed within this directory.</li><li>Download the latest ‚ÄúYearly Aircraft Registration Database‚Äù data from  <a href="https://www.faa.gov/licenses_certificates/aircraft_certification/aircraft_registry/releasable_aircraft_download" target="_blank" rel="noopener noreferrer">FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database</a> directly into the <code>aircraft-annotator</code> directory. Unzip the downloaded files &amp; run¬†<code>cleanup-data.sh</code> to clean the data.</li></ul><hr><ul><li><p>Use the following commands to install <code>pipreqs</code> (if not already installed) and auto-generate a <code>requirements.txt</code> file</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> pipreqs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipreqs </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create a file <code>Dockerfile</code> in the annotator‚Äôs directory as below:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM python</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3.8</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slim</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">buster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">aircraft</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">annotator</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install required dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip3 install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">r requirements</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD python3 annotator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create <code>build-docker.sh</code>, a script for later use in building the docker image as below:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># script to build the nats-annotator image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build -t nats-annotator </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create <code>run-docker.sh</code>, a script for later use in running the docker image, as below. Be sure to update the contents of the NATS_HOST and TOKEN as appropriate.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TODO: UPDATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert nats_host here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#in this format: nats://&lt;TOKEN&gt;@&lt;AWS-NLB-External-IP&gt;:4222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#ex:nats://TOKEN@a15d11836d0644f6da0d09cbd81fae4f-949e37ea0352e6ad.elb.us-west-2.amazonaws.com:4222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert token here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --network </span><span class="token string" style="color:#e3116c">&quot;host&quot;</span><span class="token plain"> --privileged -v /dev/bus/usb/dev/bus/usb </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -e </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${NATS_HOST}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -e </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${TOKEN}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nats-annotator:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>See another example here: <a href="https://github.com/ml4wireless/adsb-nats/blob/1ec407770eaef76e089661c8" target="_blank" rel="noopener noreferrer">https://github.com/ml4wireless/adsb-nats/blob/1ec407770eaef76e089661c8</a></li><li>Note: If using the minikube setup outlined in the Set Up phase of this documentation along with a Mac machine, you may need to define the NATS_HOST in the following alternative way: <div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${NATS_HOST</span><span class="token variable operator" style="color:#393A34">:-</span><span class="token variable" style="color:#36acaa">&quot;docker.for.mac.host.internal</span><span class="token variable operator" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">&lt;port&gt;&quot;}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${TOKEN</span><span class="token variable operator" style="color:#393A34">:-</span><span class="token variable" style="color:#36acaa">&quot;&lt;token&gt;&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-containerization--running">2. Containerization &amp; Running<a href="#2-containerization--running" class="hash-link" aria-label="Direct link to 2. Containerization &amp; Running" title="Direct link to 2. Containerization &amp; Running">‚Äã</a></h3><ul><li>Build a Docker image for the annotator (image name <code>nats-annotator</code>) using the build script we created earlier: <ul><li><em>Note:</em> If it is your first time running the script, run <code>chmod +x run-docker.sh</code> to make it executable<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./build-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><em>Optional ‚Äî Verify that the Docker build worked:</em> use the command <code>docker images</code> to list all available images, and make sure that the new <code>nats-annotator</code> image is listed</li></ul></li><li>Use the script <code>run-docker.sh</code> we created earlier to start the execution of the container:<ul><li><em>Note:</em> If it is your first time running the script, run <code>chmod +x run-docker.sh</code> to make it executable<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./run-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">üí° You should next see continuous print statements/logs from the annotator program like &quot;Published annotation ...&quot;. </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">üí° Now lets test our local containerized annotator with messages from the NATS server:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert nats_host here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert token here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># try subscribing to the stream of annotated data and you should get messages from the annotator on your console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nats sub -s¬†</span><span class="token variable" style="color:#36acaa">$NATS_HOST</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;plane.loc.annotated&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example Output:
<img loading="lazy" alt="Example output" src="/adsb-nats/assets/images/annotator_1-5c91d227ef11511fb35330a9400d714d.png" width="1772" height="714" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extras">Extras<a href="#extras" class="hash-link" aria-label="Direct link to Extras" title="Direct link to Extras">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-useful-commands">Additional Useful Commands<a href="#additional-useful-commands" class="hash-link" aria-label="Direct link to Additional Useful Commands" title="Direct link to Additional Useful Commands">‚Äã</a></h4><ul><li>Additional Docker Commands<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># **NOTE #to stop running </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> stop </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container_id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#find container id -&gt; docker ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-aws-containerizing--running-the-annotator">2. AWS: Containerizing &amp; Running the Annotator<a href="#2-aws-containerizing--running-the-annotator" class="hash-link" aria-label="Direct link to 2. AWS: Containerizing &amp; Running the Annotator" title="Direct link to 2. AWS: Containerizing &amp; Running the Annotator">‚Äã</a></h2><blockquote><p>The Annotator is a module within our data pipeline that is responsible for enriching the processed radio data with additional meaningful information. For our application, we downloaded data from the <a href="https://www.faa.gov/licenses_certificates/aircraft_certification/aircraft_registry/releasable_aircraft_download" target="_blank" rel="noopener noreferrer">FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database</a> and used it to add additional information to each packet. </p></blockquote><blockquote><p>We will now be running the containerized Annotator on an AWS EC2 instance to integrate it with the rest of our NATS pipeline backbone. Running the Annotator in the cloud also ensures scalability to handle varying workloads and high availability by leveraging the cloud infrastructure, while running it locally limits scalability and may result in resource constraints.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="containerization">Containerization<a href="#containerization" class="hash-link" aria-label="Direct link to Containerization" title="Direct link to Containerization">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-create--set-up-an-ec2-instance-for-the-annotator">1. Create &amp; Set up an EC2 Instance for the Annotator<a href="#1-create--set-up-an-ec2-instance-for-the-annotator" class="hash-link" aria-label="Direct link to 1. Create &amp; Set up an EC2 Instance for the Annotator" title="Direct link to 1. Create &amp; Set up an EC2 Instance for the Annotator">‚Äã</a></h4><blockquote><p>An <strong>EC2 instance</strong> is a virtual server in the cloud provided by Amazon Web Services (AWS) as part of their Elastic Compute Cloud (EC2) service. It offers scalable computing capacity with configurable resources such as CPU, memory, storage, and networking capabilities, allowing users to deploy and run applications on virtual machines in the AWS cloud.</p></blockquote><ul><li><p>Sign in to your AWS console, navigate to the EC2 service and create a new EC2 instance called <code>annotator-server</code></p><ul><li>For the AMI &amp; Instance type, we used <code>Amazon Linux</code> and <code>t3.small</code> respectively, with configurations as below:
<img loading="lazy" alt="Config 1" src="/adsb-nats/assets/images/annotator_2-5c9b01b4d077470d1cda24c296a1bf39.png" width="1060" height="942" class="img_ev3q"><img loading="lazy" alt="Config 2" src="/adsb-nats/assets/images/annotator_3-9c8370f02888e2ebc35c3f317ea731a9.png" width="1052" height="336" class="img_ev3q"></li><li>You also will have to add a Key Pair, Security Group, and any other EC2 specifications. Reference our Security Group configurations below if needed-<ul><li>We created a new security group for the instance that allows port 22 (SSH) (and HTTP/HTTPS but not directly needed)</li><li>Screenshots of the Inbound and Outbound rules for our Security Group are below:
<img loading="lazy" alt="Security Group Config 1" src="/adsb-nats/assets/images/annotator_4-179b17e5321ca88f9a0ae826eb607ef6.png" width="2100" height="508" class="img_ev3q"><img loading="lazy" alt="Security Group Config 2" src="/adsb-nats/assets/images/annotator_5-47ac75137fe2758596817268558b2ac5.png" width="2096" height="388" class="img_ev3q"></li><li>Make sure to link this Security Group with the <code>annotator-server</code> EC2 instance within its settings.</li></ul></li><li>Finally for the instance‚Äôs storage allowance, we kept the default setting as below:
<img loading="lazy" alt="Storage Config 1" src="/adsb-nats/assets/images/annotator_6-53302423bb85e3aeb3cc34fbe163ee21.png" width="1056" height="434" class="img_ev3q"></li></ul></li><li><p>Proceed to install and set up docker on the EC2 instance:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># in EC2 terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># based on: https://www.cyberciti.biz/faq/how-to-install-docker-on-amazon-linux-2/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> -a -G </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> ec2-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> ec2-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newgrp </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl status docker.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-collect-the-annotator-data-into-an-s3-bucket">2. Collect the Annotator Data into an S3 Bucket<a href="#2-collect-the-annotator-data-into-an-s3-bucket" class="hash-link" aria-label="Direct link to 2. Collect the Annotator Data into an S3 Bucket" title="Direct link to 2. Collect the Annotator Data into an S3 Bucket">‚Äã</a></h4><p>üí° <em>In this section, we will go over how to move the locally downloaded files of data that are needed by the annotator into an S3 bucket to Reduce Docker Image Size. This way we do not need to store this data in our AWS EC2 instance, and it can be downloaded upon the execution of the container.</em></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-and-store-data-in-s3-bucket">Create and Store Data in S3 Bucket<a href="#create-and-store-data-in-s3-bucket" class="hash-link" aria-label="Direct link to Create and Store Data in S3 Bucket" title="Direct link to Create and Store Data in S3 Bucket">‚Äã</a></h5><ul><li>Navigate to the S3 service within the AWS console and create a new S3 bucket <code>aircraft-annotator-data</code></li><li>Download the latest ‚ÄúYearly Aircraft Registration Database‚Äù data from  <em><a href="https://www.faa.gov/licenses_certificates/aircraft_certification/aircraft_registry/releasable_aircraft_download" target="_blank" rel="noopener noreferrer">FAA‚Äôs (Federal Aviation Administration) Releasable Aircraft Database</a></em> into any other directory on your computer (NOT the  <code>aircraft-annotator</code> directory since we want this directory to be lightwright).</li><li>Unzip the downloaded files &amp; run¬†<code>cleanup-data.sh</code> to clean the data. Upload the CLEANED data files into the S3 bucket we just created.</li><li>Follow the instructions in <a href="https://www.notion.so/Annotator-7a98b28d187841398f0f69e8c32261b1" target="_blank" rel="noopener noreferrer">this link</a> to make the data public and accessible.</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="allowing-the-annotator-ec2-to-access-the-s3-bucket">Allowing the Annotator EC2 to access the S3 Bucket<a href="#allowing-the-annotator-ec2-to-access-the-s3-bucket" class="hash-link" aria-label="Direct link to Allowing the Annotator EC2 to access the S3 Bucket" title="Direct link to Allowing the Annotator EC2 to access the S3 Bucket">‚Äã</a></h5><ul><li><p>Create an IAM role</p><ul><li>Look at <a href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-instance-access-s3-bucket/" target="_blank" rel="noopener noreferrer">this link</a> to learn how to give EC2 access to S3</li><li>Go to the EC2 instance page ‚Üí Actions ‚Üí  Security ‚Üí Modify IAM role and add the IAM role created</li></ul></li><li><p>Create an IAM Policy</p><ul><li>Look at <a href="https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/" target="_blank" rel="noopener noreferrer">this link</a> to write a policy for s3 access</li></ul></li><li><p><strong><em>Verify</em></strong> that the EC2 and s3 bucket are connected with the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws s3 </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> s3://aircraft-annotator-data </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># output should be something like:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PRE ReleasableAircraft/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-prepare-for-containerization--on-local-machine">3. Prepare for Containerization ‚Äî On Local Machine<a href="#3-prepare-for-containerization--on-local-machine" class="hash-link" aria-label="Direct link to 3. Prepare for Containerization ‚Äî On Local Machine" title="Direct link to 3. Prepare for Containerization ‚Äî On Local Machine">‚Äã</a></h4><p>üí° <em>Complete this section on your local machine!</em></p><ul><li><p>Navigate to the annotator‚Äôs directory (<code>aircraft-annotator</code>). This entire section of setup will be performed within this directory.</p></li><li><p>Use the following commands to install <code>pipreqs</code> (if not already installed) and auto-generate a <code>requirements.txt</code> file</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> pipreqs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipreqs </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create a file <code>Dockerfile</code> in the annotator‚Äôs directory as below:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM python</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3.8</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">slim</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">buster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">aircraft</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">annotator</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install required dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip3 install </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">r requirements</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip3 install awscli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># download annotator data from s3 bucket and execute annotator program</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD aws s3 cp s3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">//</span><span class="token plain">aircraft</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">annotator</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ReleasableAircraft </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">recursive</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> python3 annotator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create <code>build-docker.sh</code>, a script for later use in building the docker image as below:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># script to build the nats-annotator image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build -t nats-annotator </span><span class="token builtin class-name">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create <code>run-docker.sh</code>, a script for later use in running the docker image, as below. Be sure to update the contents of the NATS_HOST and TOKEN as appropriate.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TODO: UPDATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert nats_host here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#in this format: nats://&lt;TOKEN&gt;@&lt;AWS-NLB-External-IP&gt;:4222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#ex:nats://TOKEN@a15d11836d0644f6da0d09cbd81fae4f-949e37ea0352e6ad.elb.us-west-2.amazonaws.com:4222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert token here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --network </span><span class="token string" style="color:#e3116c">&quot;host&quot;</span><span class="token plain"> --privileged -v /dev/bus/usb/dev/bus/usb </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -e </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${NATS_HOST}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -e </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${TOKEN}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nats-annotator:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>See another example here: <a href="https://github.com/ml4wireless/adsb-nats/blob/1ec407770eaef76e089661c8" target="_blank" rel="noopener noreferrer">https://github.com/ml4wireless/adsb-nats/blob/1ec407770eaef76e089661c8</a></li><li>Note: If using the minikube setup outlined in the Set Up phase of this documentation along with a Mac machine, you may need to define the NATS_HOST in the following alternative way: <div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${NATS_HOST</span><span class="token variable operator" style="color:#393A34">:-</span><span class="token variable" style="color:#36acaa">&quot;docker.for.mac.host.internal</span><span class="token variable operator" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">&lt;port&gt;&quot;}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${TOKEN</span><span class="token variable operator" style="color:#393A34">:-</span><span class="token variable" style="color:#36acaa">&quot;&lt;token&gt;&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-transfer-files-from-local-machine-to-ec2-instance">4. Transfer files from Local Machine to EC2 Instance<a href="#4-transfer-files-from-local-machine-to-ec2-instance" class="hash-link" aria-label="Direct link to 4. Transfer files from Local Machine to EC2 Instance" title="Direct link to 4. Transfer files from Local Machine to EC2 Instance">‚Äã</a></h4><ul><li><p>Delete any FAA data files from the local <code>aircraft-annotator</code> directory, now that they are stored and retrievable from the <strong>S3 bucket</strong></p></li><li><p>Find and record your <code>annotator-server</code> EC2‚Äôs hostname from the AWS Console</p><ul><li><em>Go to this instance‚Äôs page in the AWS Console and click ‚ÄòConnect‚Äô. On the ‚ÄúConnect to Instance‚Äù page, navigate to the ‚ÄúSSH Client‚Äù tab and copy the EC2 hostname from command at the bottom, under ‚ÄúExample‚Äù</em></li><li>for example:
<img loading="lazy" alt="hostname example" src="/adsb-nats/assets/images/annotator_7-84484b068b66808c359591673b033a83.png" width="1304" height="122" class="img_ev3q"></li></ul></li><li><p>Use SCP to copy the local <code>aircraft-annotator</code> directory to the EC2 instance:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># in LOCAL terminal copy local files into EC2 using SCP - replace key filename, paths, ec2 hostname as needed </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> -i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">key_filename</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> -r </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">local_path_to_aircraft-annotator_directory</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">ec2_hostname</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:~/annotator-dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#---------- examples ---------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># scp -i annotator-new.pem -r /Users/johndoe/Documents/GitHub/adsb-nats/aircraft-annotator ec2-user@ec2-35-86-207-137.us-west-2.compute.amazonaws.com:~/annotator-dir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running">Running<a href="#running" class="hash-link" aria-label="Direct link to Running" title="Direct link to Running">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-running-the-containerized-annotator-on-aws">5. Running the Containerized Annotator on AWS<a href="#5-running-the-containerized-annotator-on-aws" class="hash-link" aria-label="Direct link to 5. Running the Containerized Annotator on AWS" title="Direct link to 5. Running the Containerized Annotator on AWS">‚Äã</a></h4><ul><li>Connect to the <code>annotator-server</code> EC2 instance via SSH<ul><li><em>For instructions, go to this instance‚Äôs page in the AWS Console and click ‚ÄòConnect‚Äô. On the ‚ÄúConnect to Instance‚Äù page, navigate to the ‚ÄúSSH Client‚Äù tab and copy the command at the bottom, under ‚ÄúExample‚Äù</em></li></ul></li><li>Build a Docker image for the annotator (image name <code>nats-annotator</code>) using the build script we created earlier:<ul><li><em>Note:</em> If it is your first time running the script, run <code>chmod +x [run-docker.sh](http://run-docker.sh)</code> to make it executable<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./build-docker-aws.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><em>Optional Check</em>: use the command <code>docker images</code> to list all available images, and make sure that the new <code>nats-annotator</code> image is listed</li></ul></li><li>Create a screen session to use to keep the annotator program <strong>executing in the background</strong>:<ul><li>otherwise it will stop annotating the data the second you exit the program<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># in EC2 terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">screen</span><span class="token plain"> -S </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">session_name</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li>Use the script <code>run-docker.sh</code> we created earlier to start the execution of the container:<ul><li>Add in your token in the run-docker.sh by using vim commands in the EC2</li><li><em>Note:</em> If it is your first time running the script, run chmod +x run-docker.sh to make it executable<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./run-docker.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>You should first see confirmation of the annotator data being downloaded from the s3 bucket</li><li>You should next see continuous print statements/logs from the annotator program like &quot;Published annotation ...&quot;</li></ul></li><li>Detach the Screen session <em>(keeps the annotator program running in the background even if you exit the terminal)</em><ul><li>press <code>ctrl + a + d</code> to detach it -&gt; you are now done (you may have to try doing this multiple times for it to work)</li><li><em>Optional Check: To make sure the screen session was created and detached, use the command <code>screen -list</code>. You should see something like this-</em><img loading="lazy" alt="screen example" src="/adsb-nats/assets/images/annotator_8-cf55eee5520d86c97ffab75ff47b8be7.png" width="1056" height="204" class="img_ev3q"></li></ul></li></ul><hr><p>üí° Now lets test our containerized annotator with messages from the NATS server. Run the following command on your local terminal to hopefully see the stream of annotated messages from the Annotator module working on cloud.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NATS_HOST</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert nats_host here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;insert token here&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># try subscribing to the stream of annotated data and you should get messages from the annotator on your console</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nats sub -s¬†</span><span class="token variable" style="color:#36acaa">$NATS_HOST</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;plane.loc.annotated&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example Output:
<img loading="lazy" alt="Example Output 2" src="/adsb-nats/assets/images/annotator_9-5c91d227ef11511fb35330a9400d714d.png" width="1772" height="714" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extras-1">Extras<a href="#extras-1" class="hash-link" aria-label="Direct link to Extras" title="Direct link to Extras">‚Äã</a></h3><p><a href="https://marvelous-mailbox-230.notion.site/AWS-Debugging-Help-4d6aa9e3ca1243c8bdcd993bd125eb1f" target="_blank" rel="noopener noreferrer">AWS Debugging Help</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-useful-commands-1">Additional Useful Commands<a href="#additional-useful-commands-1" class="hash-link" aria-label="Direct link to Additional Useful Commands" title="Direct link to Additional Useful Commands">‚Äã</a></h4><ul><li><p>Additional Docker Commands</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># **NOTE #to stop running </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> stop </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">container_id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#find container id -&gt; docker ps</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Additional Screen Commands </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#SCREEN DEBUGGING HELP: </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">screen</span><span class="token plain"> -list </span><span class="token comment" style="color:#999988;font-style:italic"># list sessions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># re-attach to a detached session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">screen</span><span class="token plain"> -r session_name </span><span class="token comment" style="color:#999988;font-style:italic"># run if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#kill all sessions: </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">pkill</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">screen</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># kill a session:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">screen</span><span class="token plain"> -r </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">session_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># to first re-attach to the screen session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Then press </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">ctrl + a</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> and </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">k</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> and press </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">y</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> when it asks </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> you really want to </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> the session</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging-help">Debugging Help<a href="#debugging-help" class="hash-link" aria-label="Direct link to Debugging Help" title="Direct link to Debugging Help">‚Äã</a></h2><p><a href="https://marvelous-mailbox-230.notion.site/Instructions-to-Restart-Annotator-on-AWS-489d3acb4a554be7ae0b5d8c56c87d0f" target="_blank" rel="noopener noreferrer">Instructions to Restart Annotator on AWS</a></p><p><a href="https://marvelous-mailbox-230.notion.site/AWS-Debugging-Help-4d6aa9e3ca1243c8bdcd993bd125eb1f" target="_blank" rel="noopener noreferrer">AWS Debugging Help</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/adsb-nats/next/replicate/client"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Client</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adsb-nats/next/replicate/elastic"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Storage &amp; Search Engine</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-local-containerizing--running-the-annotator" class="table-of-contents__link toc-highlight">1. Local: Containerizing &amp; Running the Annotator</a><ul><li><a href="#1-prep-for-containerization" class="table-of-contents__link toc-highlight">1. Prep for Containerization</a></li><li><a href="#2-containerization--running" class="table-of-contents__link toc-highlight">2. Containerization &amp; Running</a></li><li><a href="#extras" class="table-of-contents__link toc-highlight">Extras</a></li></ul></li><li><a href="#2-aws-containerizing--running-the-annotator" class="table-of-contents__link toc-highlight">2. AWS: Containerizing &amp; Running the Annotator</a><ul><li><a href="#containerization" class="table-of-contents__link toc-highlight">Containerization</a></li><li><a href="#running" class="table-of-contents__link toc-highlight">Running</a></li><li><a href="#extras-1" class="table-of-contents__link toc-highlight">Extras</a></li></ul></li><li><a href="#debugging-help" class="table-of-contents__link toc-highlight">Debugging Help</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/adsb-nats/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/adsb-nats/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ml4wireless/adsb-nats" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 ml4wireless. Built with Docusaurus.</div></div></div></footer></div>
<script src="/adsb-nats/assets/js/runtime~main.23d5e543.js"></script>
<script src="/adsb-nats/assets/js/main.d57262cb.js"></script>
</body>
</html>