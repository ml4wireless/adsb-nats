<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.0.1 plugin-docs plugin-id-default docs-doc-id-replicate/aws">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">NATS Setup | Data Pipeline for Spectrum</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ml4wireless.github.io/adsb-nats/replicate/aws"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.0.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.0.1"><meta data-rh="true" name="docsearch:version" content="1.0.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.0.1"><meta data-rh="true" property="og:title" content="NATS Setup | Data Pipeline for Spectrum"><meta data-rh="true" name="description" content="💡 In the NATS Setup Section, you will be guided through creating a new EKS Cluster, connecting to it, starting a NATS Server, connecting to it, and finally creating a Network Load Balancer."><meta data-rh="true" property="og:description" content="💡 In the NATS Setup Section, you will be guided through creating a new EKS Cluster, connecting to it, starting a NATS Server, connecting to it, and finally creating a Network Load Balancer."><link data-rh="true" rel="icon" href="/adsb-nats/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ml4wireless.github.io/adsb-nats/replicate/aws"><link data-rh="true" rel="alternate" href="https://ml4wireless.github.io/adsb-nats/replicate/aws" hreflang="en"><link data-rh="true" rel="alternate" href="https://ml4wireless.github.io/adsb-nats/replicate/aws" hreflang="x-default"><link rel="stylesheet" href="/adsb-nats/assets/css/styles.9ff04917.css">
<link rel="preload" href="/adsb-nats/assets/js/runtime~main.4ca28bb4.js" as="script">
<link rel="preload" href="/adsb-nats/assets/js/main.4212f0ea.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/adsb-nats/"><div class="navbar__logo"><img src="/adsb-nats/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/adsb-nats/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/adsb-nats/">Documentation</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/adsb-nats/">1.0.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/adsb-nats/next/replicate/aws">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/adsb-nats/replicate/aws">1.0.1</a></li><li><a class="dropdown__link" href="/adsb-nats/1.0.0/replicate/aws">1.0.0</a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/about">About the Project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/local">Setup &amp; Run Through (Local)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/adsb-nats/category/replicate-our-pipeline">Replicate our Pipeline</a><button aria-label="Toggle the collapsible sidebar category &#x27;Replicate our Pipeline&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adsb-nats/replicate/aws">NATS Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/client">Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/annotator">Annotator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/elastic">Storage &amp; Search Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/backend">Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/frontend">Frontend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/dashboard">Dashboards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adsb-nats/replicate/stress_test">Stress Test</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adsb-nats/doc_tutorial">Documentation Website</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/adsb-nats/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/adsb-nats/category/replicate-our-pipeline"><span itemprop="name">Replicate our Pipeline</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NATS Setup</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.0.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>NATS Setup</h1><aside>💡 In the NATS Setup Section, you will be guided through creating a new EKS Cluster, connecting to it, starting a [NATS](http://NATS.io) Server, connecting to it, and finally creating a Network Load Balancer.</aside><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-creating-a-new-eks-cluster">1. Creating a new EKS Cluster<a href="#1-creating-a-new-eks-cluster" class="hash-link" aria-label="Direct link to 1. Creating a new EKS Cluster" title="Direct link to 1. Creating a new EKS Cluster">​</a></h2><p>💡 Amazon Elastic Kubernetes Service (Amazon EKS) is a managed service that you can use to run Kubernetes on AWS without needing to install, operate, and maintain your own Kubernetes control plane or nodes. Kubernetes is an open-source system for automating the deployment, scaling, and management of containerized applications. <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html" target="_blank" rel="noopener noreferrer">(source)</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-prerequisites-to-download">1) Prerequisites to Download<a href="#1-prerequisites-to-download" class="hash-link" aria-label="Direct link to 1) Prerequisites to Download" title="Direct link to 1) Prerequisites to Download">​</a></h3><aside>💡 Some of the following information was taken from: [https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html](https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html)</aside><ul><li>Eksctl<!-- -->  <img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_7-da1544cc93a79d7cd407bf831a4a0a19.png" width="660" height="96" class="img_ev3q"><ul><li><a href="https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html</a></li></ul></li><li>kubectl<!-- -->  <img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_1-1bb6002a53c7ed0686910f369df8f072.png" width="646" height="98" class="img_ev3q"></li><li>AWS CLI<ul><li>aws cli installation: <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html</a><ul><li><code>curl &quot;[https://awscli.amazonaws.com/AWSCLIV2.pkg](https://awscli.amazonaws.com/AWSCLIV2.pkg)&quot; -o &quot;AWSCLIV2.pkg&quot;</code></li><li><code>sudo installer -pkg AWSCLIV2.pkg -target /</code></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-get-key">2) Get Key<a href="#2-get-key" class="hash-link" aria-label="Direct link to 2) Get Key" title="Direct link to 2) Get Key">​</a></h3><ul><li>Get Key<ul><li>In the AWS Console:<ul><li>Click your account name in the top right corner → select “Security Credentials” from the drop down menu</li><li>Create a key for CLI access and download it under <strong>Access keys</strong>  (for CLI, SDK, &amp; API access)</li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-assume-role">3) Assume Role<a href="#3-assume-role" class="hash-link" aria-label="Direct link to 3) Assume Role" title="Direct link to 3) Assume Role">​</a></h3><ul><li>In your terminal, configure local AWS access key: <code>aws configure</code> and enter in the prompted information</li></ul><p><img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_2-a3136f27288c8cc4610c915fa3003048.png" width="658" height="268" class="img_ev3q"></p><ul><li>Create a text file called assume-eks-admin-role.txt with the following code<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">printf</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;AWS_ACCESS_KEY_ID=%s AWS_SECRET_ACCESS_KEY=%s AWS_SESSION_TOKEN=%s&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">aws sts assume-role </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">--role-arn arn:aws:iam::563060118978:role/eks-admin </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">--role-session-name </span><span class="token variable environment constant" style="color:#36acaa">$USER</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">--query </span><span class="token variable string" style="color:#e3116c">&quot;Credentials.[AccessKeyId,SecretAccessKey,SessionToken]&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">\</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">--output text</span><span class="token variable" style="color:#36acaa">)</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><code>cat aws/assume-eks-admin-role.txt</code> and copy/paste the command in the terminal<ol><li>Note: if you are having permission issues revisit the Required IAM permissions section above. We had to add our username to <strong>IAM → Roles → eks_admin</strong> as a Trusted Entity </li></ol></li><li><code>aws sts get-caller-identity</code> <ol><li>This should return “arn” = “…:assumed-role/eks-admin”</li></ol></li></ol></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-create-the-cluster-in-command-line">4) Create the cluster in command line<a href="#4-create-the-cluster-in-command-line" class="hash-link" aria-label="Direct link to 4) Create the cluster in command line" title="Direct link to 4) Create the cluster in command line">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Create 3 node Kubernetes cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> YOUR_EKS_NAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">insert your eks cluster name here</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># ours is data-pipeline-small-test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl create cluster --name </span><span class="token variable" style="color:#36acaa">$YOUR_EKS_NAME</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nodes </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">t3.small </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">us-west-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the credentials for your cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eksctl utils write-kubeconfig --name </span><span class="token variable" style="color:#36acaa">$YOUR_EKS_NAME</span><span class="token plain"> --region eu-west-1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-connecting-to-the-new-eks-cluster">2. Connecting to the new EKS Cluster<a href="#2-connecting-to-the-new-eks-cluster" class="hash-link" aria-label="Direct link to 2. Connecting to the new EKS Cluster" title="Direct link to 2. Connecting to the new EKS Cluster">​</a></h2><ol><li><p><code>cat aws/assume-eks-admin-role.txt</code> and copy/paste the command in the terminal</p></li><li><p><code>aws eks update-kubeconfig -—region us-west-2 -—name $YOUR_EKS_NAME</code></p><ol><li>ex:<code>aws eks update-kubeconfig --region us-west-2 --name data-pipeline-small-test</code></li><li>This connects us to the kubernetes cluster we created</li></ol></li><li><p><code>kubectl get nodes</code> — see the nodes in our newly created cluster</p><ol><li>example output:</li></ol><p><img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_3-655b8d23294f301a4f5bc9892011e31b.png" width="2258" height="188" class="img_ev3q"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-starting-the-nats-server">3. Starting the NATS Server<a href="#3-starting-the-nats-server" class="hash-link" aria-label="Direct link to 3. Starting the NATS Server" title="Direct link to 3. Starting the NATS Server">​</a></h2><aside>💡 NATS is an open-source, high-performance messaging system that provides publish-subscribe and request-reply messaging patterns. NATS can help you to build a distributed system that is scalable, flexible, resilient, and performant, making it a popular choice for cloud-native architectures and microservices-based applications (Chat GPT).</aside><ol><li><p><code>cat aws/assume-eks-admin-role.txt</code> and copy/paste the command in the terminal</p></li><li><p>helm install</p><ul><li>define your TOKEN variable (you will continue to use this often)</li><li><code>sudo -E helm install plane-nats nats/nats -f config/k8s-values.yml --set auth.token=$TOKEN</code></li><li>example output:<!-- -->  <img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_4-2fac53ff0e2aacba611dd337e3c462d1.png" width="1240" height="778" class="img_ev3q"></li><li>Debugging Help<ul><li>If  you encounter issues, try <code>helm repo update</code> and <code>helm repo list</code></li><li>The default config of nats can be seen in <a href="https://artifacthub.io/packages/helm/nats/nats" target="_blank" rel="noopener noreferrer">https://artifacthub.io/packages/helm/nats/nats</a></li><li>a possibly helpful reference: <a href="https://dev.to/karanpratapsingh/nats-with-kubernetes-3bmc" target="_blank" rel="noopener noreferrer">https://dev.to/karanpratapsingh/nats-with-kubernetes-3bmc</a></li></ul></li><li>Deleting Nats Server (only if you need to delete/restart it at some point)<ul><li><code>kubectl get services</code></li><li>if removing any: use the script <code>cleanup-k8s.sh</code> from the repo<!-- -->  <img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_5-239a752e3471319bfd58c1e5f3de8808.png" width="536" height="254" class="img_ev3q"></li></ul></li></ul></li><li><p><code>kubectl apply -f ./server/config/nats-service.yml</code></p><ul><li>should see service <code>plant-nats</code>created when you do <code>kubectl get svc</code></li></ul><p><img loading="lazy" alt="Untitled" src="/adsb-nats/assets/images/aws_6-7c88eb27f2a75d0629599dac73c85d99.png" width="2054" height="370" class="img_ev3q"></p><ul><li><strong>no <code>sudo</code> in this command!</strong></li></ul></li></ol><aside>💡 After starting the NATS Server we now have the backbone of our messaging system. We will be connecting messages through different components into the NATS messaging system.</aside><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-creating-a-network-load-balancer">4. Creating a Network Load Balancer<a href="#4-creating-a-network-load-balancer" class="hash-link" aria-label="Direct link to 4. Creating a Network Load Balancer" title="Direct link to 4. Creating a Network Load Balancer">​</a></h2><aside>💡 A Network Load Balancer (NLB) is a type of load balancer that operates at the network layer and is used to distribute incoming network traffic across multiple targets, such as EC2 instances, containers, or IP addresses, in order to improve availability, scalability, and performance of your applications or services.</aside><aside>💡 We need a network load balancer to balance the workload between our three nodes in EKS (Chat GPT).</aside><p>*Some of the following information was taken from <a href="https://docs.nats.io/running-a-nats-service/nats-kubernetes/nats-external-nlb" target="_blank" rel="noopener noreferrer">this link</a></p><ol><li><p>One-line installer creates a secure cluster named &#x27;nats’</p><ul><li>Run the following: <code>curl -sSL [https://raw.githubusercontent.com/nats-io/k8s/master/setup.sh](https://raw.githubusercontent.com/nats-io/k8s/master/setup.sh) | sh</code></li></ul></li><li><p>Create AWS Network Load Balancer service</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  name: nats-nlb</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app: nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    service.beta.kubernetes.io/aws-load-balancer-type: &quot;nlb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  type: LoadBalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  externalTrafficPolicy: Local</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - name: nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    port: 4222</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    targetPort: 4222</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    app.kubernetes.io/name: nats</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Check that it worked </p><ul><li>Run the following: <code>kubectl get svc nats-nlb -o wide</code><ul><li>The output should look like:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NAME       TYPE           CLUSTER-IP      EXTERNAL-IP                                                                     PORT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">          AGE    SELECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nats-nlb   LoadBalancer   </span><span class="token number" style="color:#36acaa">10.100</span><span class="token plain">.67.123   a18b60a948fc611eaa7840286c60df32-9e96a2af4b5675ec.elb.us-east-2.amazonaws.com   </span><span class="token number" style="color:#36acaa">4222</span><span class="token plain">:30297/TCP   151m   </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nats</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li>test connection to the load balancer endpoint (check if port is open from our side) with: <code>netcat -zv [EXTERNAL-IP] 4222</code></li></ul></li></ol><aside>💡 Now that you have done some of the building blocks let’s test and see if we can send and receive messages!</aside><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-test-sending--receiving-messages">5. Test Sending &amp; Receiving Messages<a href="#5-test-sending--receiving-messages" class="hash-link" aria-label="Direct link to 5. Test Sending &amp; Receiving Messages" title="Direct link to 5. Test Sending &amp; Receiving Messages">​</a></h2><ul><li><p>Create a NATS context</p><ul><li>“The <code>nats</code> CLI supports multiple named configurations. We refer to these configurations as <em>“context”</em>. In these contexts, we can configure the server, credentials, certs, and much more.” Check out <a href="https://dev.to/karanpratapsingh/introduction-to-nats-cli-33nk" target="_blank" rel="noopener noreferrer">this link</a> for more information (Context section)</li><li><code>nats context save **[CONTEXT-NAME]** --server=nats://**[TOKEN]@[EXTERNAL-IP]:4222**</code><ul><li>ex: <code>nats context save my-context --server=nats://token@a82c025f6da29437cb87d53a7c616262-b7af42cbc4ec8f0a.elb.us-west-2.amazonaws.com:4222</code></li></ul></li><li><code>nats context select **[CONTEXT-NAME]**</code></li></ul></li><li><p>Test out publishing a test message and subscribing to receive that message</p><ul><li>subscribe:<ul><li>command format: <code>nats sub -s **nats://[TOKEN]@[EXTERNAL-IP]:4222** &quot;&gt;&quot;</code> ****(we use token to do authentication so we need this format)</li><li>ex: <code>nats sub -s nats://token@[a82c025f6da29437cb87d53a7c616262-b7af42cbc4ec8f0a.elb.us-west-2.amazonaws.com](http://a82c025f6da29437cb87d53a7c616262-b7af42cbc4ec8f0a.elb.us-west-2.amazonaws.com/):4222 “&gt;”</code></li><li>or if you’ve already set &amp; selected your NATS context simply use the command: <code>nats sub &quot;&gt;&quot;</code></li><li>you should see something like the following as output: <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>(note: message will be received after also doing the pub step below)<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">18</span><span class="token plain">:18:38 Subscribing on </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token comment" style="color:#999988;font-style:italic">#1] Received on &quot;test.foo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul></li><li><p>pub:</p><ul><li>ex: <code>nats pub -s nats://token@[a82c025f6da29437cb87d53a7c616262-b7af42cbc4ec8f0a.elb.us-west-2.amazonaws.com](http://a82c025f6da29437cb87d53a7c616262-b7af42cbc4ec8f0a.elb.us-west-2.amazonaws.com/):4222 test.foo &quot;&gt;bar&quot;</code></li><li>or if you’ve already set &amp; selected your NATS context simply use the command: <code>nats pub &quot;&gt;&quot;</code></li><li>you should see something like the following as output:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">18</span><span class="token plain">:19:59 Published </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> bytes to </span><span class="token string" style="color:#e3116c">&quot;test.foo&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li></ul><hr><p>🐞 Debugging Help: <a href="https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering/troubleshooting" target="_blank" rel="noopener noreferrer">https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering/troubleshooting</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/adsb-nats/replicate/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adsb-nats/replicate/client"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Client</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-creating-a-new-eks-cluster" class="table-of-contents__link toc-highlight">1. Creating a new EKS Cluster</a><ul><li><a href="#1-prerequisites-to-download" class="table-of-contents__link toc-highlight">1) Prerequisites to Download</a></li><li><a href="#2-get-key" class="table-of-contents__link toc-highlight">2) Get Key</a></li><li><a href="#3-assume-role" class="table-of-contents__link toc-highlight">3) Assume Role</a></li><li><a href="#4-create-the-cluster-in-command-line" class="table-of-contents__link toc-highlight">4) Create the cluster in command line</a></li></ul></li><li><a href="#2-connecting-to-the-new-eks-cluster" class="table-of-contents__link toc-highlight">2. Connecting to the new EKS Cluster</a></li><li><a href="#3-starting-the-nats-server" class="table-of-contents__link toc-highlight">3. Starting the NATS Server</a></li><li><a href="#4-creating-a-network-load-balancer" class="table-of-contents__link toc-highlight">4. Creating a Network Load Balancer</a></li><li><a href="#5-test-sending--receiving-messages" class="table-of-contents__link toc-highlight">5. Test Sending &amp; Receiving Messages</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/adsb-nats/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/adsb-nats/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/ml4wireless/adsb-nats" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ml4wireless. Built with Docusaurus.</div></div></div></footer></div>
<script src="/adsb-nats/assets/js/runtime~main.4ca28bb4.js"></script>
<script src="/adsb-nats/assets/js/main.4212f0ea.js"></script>
</body>
</html>